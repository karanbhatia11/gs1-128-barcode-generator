<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GS1-128 Barcode PDF Generator</title>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .logo {
      text-align: center;
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 2px;
      margin-bottom: 20px;
    }

    .logo span {
      border-bottom: 4px solid #ff4fd8;
      padding-bottom: 4px;
    }

    .toggle {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }

    button {
      padding: 10px 16px;
      cursor: pointer;
    }

    .panel {
      display: none;
      margin-bottom: 20px;
    }

    .panel.active {
      display: block;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }

    .preview {
      margin-top: 30px;
      text-align: center;
    }

    .barcode-block {
      margin: 30px 0;
    }

    .download {
      margin-top: 20px;
      opacity: 0.4;
    }

    .download.enabled {
      opacity: 1;
    }

    @media print {
      body {
        padding: 0;
      }
      .toggle,
      .panel,
      h2,
      .download {
        display: none;
      }
    }
  </style>
</head>
<body>

<div class="container">

  <div class="logo"><span>SKUTOPIA</span></div>

  <h2>GS1-128 Barcode PDF Generator</h2>

  <div class="toggle">
    <button onclick="showPanel('manual')">Manual Entry</button>
    <button onclick="showPanel('excel')">Upload Excel</button>
  </div>

  <!-- MANUAL -->
  <div id="manual" class="panel active">
    <input id="itemNumber" placeholder="Item Number">
    <input id="useBy" placeholder="Use By (DD.MM.YY)">
    <input id="batch" placeholder="Batch">
    <input id="quantity" placeholder="Quantity">
    <input id="sscc" placeholder="SSCC">
    <button onclick="generateManual()">Generate</button>
  </div>

  <!-- EXCEL -->
  <div id="excel" class="panel">
    <input type="file" id="excelFile" accept=".xlsx">
    <button onclick="generateFromExcel()">Generate</button>
  </div>

  <!-- PREVIEW -->
  <div class="preview" id="preview"></div>

  <button id="downloadBtn" class="download" disabled onclick="window.print()">
    Download PDF
  </button>

</div>

<script>
let records = [];

function showPanel(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ===== MANUAL ===== */
function generateManual() {
  records = [{
    itemNumber: itemNumber.value,
    useBy: useBy.value,
    batch: batch.value,
    quantity: quantity.value,
    sscc: sscc.value
  }];
  renderPreview();
}

/* ===== EXCEL ===== */
function generateFromExcel() {
  const file = excelFile.files[0];
  if (!file) {
    alert("Upload Excel file");
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(e.target.result, { type: "binary" });
    const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
    if (!rows.length) {
      alert("Excel file is empty");
      return;
    }
    records = rows;
    renderPreview();
  };
  reader.readAsBinaryString(file);
}

/* ===== PREVIEW + PRINT SOURCE ===== */
function renderPreview() {
  const preview = document.getElementById("preview");
  preview.innerHTML = "";

  records.forEach((r, i) => {
    const gs1 =
      `(02)${r.itemNumber}` +
      `(17)${r.useBy.replaceAll('.', '')}` +
      `(10)${r.batch}` +
      `(37)${r.quantity}`;

    const ssccText = `(00)${r.sscc}`;

    const div = document.createElement("div");
    div.className = "barcode-block";

    div.innerHTML = `
      <svg id="gs1-${i}"></svg>
      <svg id="sscc-${i}"></svg>
    `;

    preview.appendChild(div);

    JsBarcode(`#gs1-${i}`, gs1, {
      format: "CODE128",
      width: 2,
      height: 80,
      displayValue: true
    });

    JsBarcode(`#sscc-${i}`, ssccText, {
      format: "CODE128",
      width: 2,
      height: 80,
      displayValue: true
    });
  });

  const btn = document.getElementById("downloadBtn");
  btn.disabled = false;
  btn.classList.add("enabled");
}
</script>

</body>
</html>
