<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GS1 Excel Parser</title>

<!-- SheetJS (GitHub Pages safe CDN) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #f7f7f7;
  margin: 0;
  padding: 30px;
}

.container {
  max-width: 900px;
  margin: auto;
  background: #ffffff;
  padding: 25px;
  border-radius: 6px;
}

h2 {
  margin-top: 0;
}

button {
  padding: 8px 16px;
  margin-top: 10px;
}

pre {
  margin-top: 20px;
  background: #111;
  color: #0f0;
  padding: 15px;
  max-height: 400px;
  overflow: auto;
  font-size: 12px;
}

.status {
  margin-top: 15px;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="container">
  <h2>GS1 Excel Parser (Debug Page)</h2>

  <input type="file" id="excelFile" accept=".xlsx">
  <br><br>

  <button onclick="parseExcel()">Parse Excel & Continue</button>

  <div class="status" id="status">Waiting for file…</div>

  <pre id="output"></pre>
</div>

<script>
function parseExcel() {
  const fileInput = document.getElementById("excelFile");
  const status = document.getElementById("status");
  const output = document.getElementById("output");

  status.textContent = "";
  output.textContent = "";

  if (!fileInput.files.length) {
    status.textContent = "❌ No file selected";
    return;
  }

  const reader = new FileReader();

  reader.onload = e => {
    try {
      const workbook = XLSX.read(e.target.result, {
        type: "binary",
        cellDates: true
      });

      const sheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[sheetName];

      const rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });

      if (!rows.length) {
        status.textContent = "❌ Excel file is empty";
        return;
      }

      // Persist rows for bulk.html
      sessionStorage.setItem("gs1Rows", JSON.stringify(rows));

      status.textContent = `✅ Parsed ${rows.length} rows successfully`;
      output.textContent = JSON.stringify(rows, null, 2);

      // Redirect to bulk generator
      setTimeout(() => {
        window.location.href = "bulk.html";
      }, 500);

    } catch (err) {
      status.textContent = "❌ Error parsing Excel";
      output.textContent = err.message;
      console.error(err);
    }
  };

  reader.readAsBinaryString(fileInput.files[0]);
}
</script>

</body>
</html>
