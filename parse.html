<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GS1 Excel Parser</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #f7f7f7;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 900px;
  margin: auto;
  background: #ffffff;
  padding: 20px;
  border-radius: 6px;
}

button {
  padding: 8px 16px;
  margin-top: 10px;
}

pre {
  margin-top: 20px;
  background: #111;
  color: #0f0;
  padding: 15px;
  max-height: 400px;
  overflow: auto;
  font-size: 12px;
}

.notice {
  margin-top: 10px;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="container">
  <h2>GS1 Excel Parser (Debug Page)</h2>

  <input type="file" id="excelFile" accept=".xlsx">
  <br>
  <button onclick="parseExcel()">Parse Excel</button>
  <button onclick="goToBulk()">Continue to Bulk Print</button>

  <div class="notice" id="status"></div>

  <pre id="output"></pre>
</div>

<script>
function parseExcel() {
  const fileInput = document.getElementById("excelFile");
  const output = document.getElementById("output");
  const status = document.getElementById("status");

  output.textContent = "";
  status.textContent = "";

  if (!fileInput.files.length) {
    status.textContent = "❌ No file selected";
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    try {
      const workbook = XLSX.read(e.target.result, {
        type: "binary",
        cellDates: true
      });

      const sheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[sheetName];

      const rows = XLSX.utils.sheet_to_json(sheet, {
        defval: ""
      });

      if (!rows.length) {
        status.textContent = "❌ Excel sheet is empty";
        return;
      }

      // Save parsed rows for bulk.html
      localStorage.setItem("gs1_bulk_rows", JSON.stringify(rows));

      status.textContent =
        "✅ Parsed " + rows.length + " rows successfully. Data saved.";

      output.textContent = JSON.stringify(rows, null, 2);

    } catch (err) {
      status.textContent = "❌ Error parsing Excel";
      output.textContent = err.message;
      console.error(err);
    }
  };

  reader.readAsBinaryString(fileInput.files[0]);
}

function goToBulk() {
  const data = localStorage.getItem("gs1_bulk_rows");
  if (!data) {
    alert("No parsed data found. Please parse Excel first.");
    return;
  }
  window.location.href = "bulk.html";
}
</script>

</body>
</html>
